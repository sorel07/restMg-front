---
import AwaiterLayout from '../../layouts/AwaiterLayout.astro';
---

<AwaiterLayout title="Panel de Mesero">
  <div class="container mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-white">Panel de Mesero</h1>
    </div>

    <!-- Sección de Pedidos -->
    <div id="orders-section" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
      
      <!-- Columna: Esperando Aprobación de Pago -->
      <div id="awaiting-payment-column">
        <h2 class="text-xl font-semibold text-yellow-400 mb-4">Esperando Aprobación</h2>
        <div class="space-y-4">
          <div id="awaiting-payment-loading">
             <div class="bg-surface rounded-lg p-4 border border-yellow-500/30 animate-pulse">
                <div class="h-4 bg-slate-700 rounded w-3/4 mb-2"></div>
                <div class="h-3 bg-slate-700 rounded w-1/2"></div>
             </div>
          </div>
          <div id="awaiting-payment-empty" class="text-center py-8 hidden rounded-lg border-2 border-dashed border-surface-variant">
            <p class="text-text-secondary">No hay pedidos esperando pago.</p>
          </div>
          <div id="awaiting-payment-cards" class="space-y-4"></div>
        </div>
      </div>

      <!-- Columna: Listos para Entregar -->
      <div id="ready-to-deliver-column">
        <h2 class="text-xl font-semibold text-green-400 mb-4">Listos para Entregar</h2>
        <div class="space-y-4">
           <div id="ready-to-deliver-loading">
             <div class="bg-surface rounded-lg p-4 border border-green-500/30 animate-pulse">
                <div class="h-4 bg-slate-700 rounded w-3/4 mb-2"></div>
                <div class="h-3 bg-slate-700 rounded w-1/2"></div>
             </div>
           </div>
          <div id="ready-to-deliver-empty" class="text-center py-8 hidden rounded-lg border-2 border-dashed border-surface-variant">
            <p class="text-text-secondary">No hay pedidos listos.</p>
          </div>
          <div id="ready-to-deliver-cards" class="space-y-4"></div>
        </div>
      </div>

      <!-- Columna: Entregados -->
      <div id="delivered-column">
        <h2 class="text-xl font-semibold text-gray-400 mb-4">Recientemente Entregados</h2>
        <div class="space-y-4">
           <div id="delivered-loading">
             <div class="bg-surface rounded-lg p-4 border border-gray-700/30 animate-pulse">
                <div class="h-4 bg-slate-700 rounded w-3/4 mb-2"></div>
                <div class="h-3 bg-slate-700 rounded w-1/2"></div>
             </div>
           </div>
          <div id="delivered-empty" class="text-center py-8 hidden rounded-lg border-2 border-dashed border-surface-variant">
            <p class="text-text-secondary">Aún no se han entregado pedidos.</p>
          </div>
          <div id="delivered-cards" class="space-y-4"></div>
          <div id="delivered-footer" class="text-center mt-2"></div>
        </div>
      </div>
    </div>
    <div id="orders-section-error" class="text-center py-8 hidden">
        <p class="text-red-500">Error al cargar los pedidos.</p>
    </div>

    <!-- Sección de Mesas -->
    <div id="tables-section" class="mb-6">
        <h2 class="text-2xl font-bold text-white mb-4">Estado de las Mesas</h2>
        <div id="tables-loading" class="text-center py-8">
            <p class="text-text-secondary">Cargando mesas...</p>
        </div>
        <div id="tables-error" class="text-center py-8 hidden">
            <p class="text-red-500">Error al cargar las mesas.</p>
        </div>
        <div id="tables-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
        </div>
         <div id="tables-empty" class="text-center py-8 hidden rounded-lg border-2 border-dashed border-surface-variant">
            <p class="text-text-secondary">No hay mesas configuradas.</p>
          </div>
    </div>

  </div>

  <!-- Modal para Historial de Entregados -->
  <div id="delivered-history-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
    <div class="bg-background-alt rounded-xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col">
      <div class="flex justify-between items-center p-4 border-b border-surface">
        <h3 class="text-xl font-bold text-white">Historial de Pedidos Entregados</h3>
        <button id="close-history-modal-btn" class="text-gray-400 hover:text-white">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </div>
      <div id="delivered-history-list" class="p-4 space-y-3 overflow-y-auto">
        <!-- La lista del historial se renderizará aquí -->
      </div>
    </div>
  </div>

</AwaiterLayout>

<script>
  import "../../scripts/awaiter-page.ts";
</script>

