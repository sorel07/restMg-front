---
// Pre-renderizar esta página estáticamente
export const prerender = true;

import AdminLayout from "../../../layouts/AdminLayout.astro";
---

<AdminLayout title="Reportes">
  <div class="space-y-8">
    <div class="flex justify-between items-center">
      <h1 class="font-heading text-4xl font-bold text-text-primary">
        Reportes
      </h1>
    </div>

    <!-- Filtros de Fecha -->
    <div class="bg-surface rounded-xl p-6 border border-white/10">
      <h2 class="font-heading text-xl font-semibold text-text-primary mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
        </svg>
        Filtros
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
        <div class="space-y-2">
          <label for="date-from" class="block text-sm font-medium text-text-primary">
            Desde
          </label>
          <input
            type="date"
            id="date-from"
            class="w-full px-3 py-2.5 text-sm bg-background text-text-primary border border-white/20 rounded-lg focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all"
            style="color-scheme: dark;"
          />
        </div>
        
        <div class="space-y-2">
          <label for="date-to" class="block text-sm font-medium text-text-primary">
            Hasta
          </label>
          <input
            type="date"
            id="date-to"
            class="w-full px-3 py-2.5 text-sm bg-background text-text-primary border border-white/20 rounded-lg focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all"
            style="color-scheme: dark;"
          />
        </div>
        
        <div class="flex gap-2">
          <button
            id="apply-filters-btn"
            class="flex-1 bg-accent text-white px-4 py-2.5 rounded-lg hover:bg-opacity-80 transition-colors font-medium text-sm"
          >
            Aplicar Filtros
          </button>
          <button
            id="clear-filters-btn"
            class="flex-1 bg-background text-text-primary border border-white/20 px-4 py-2.5 rounded-lg hover:bg-white/5 transition-colors font-medium text-sm"
          >
            Limpiar
          </button>
        </div>
      </div>
    </div>

    <!-- Grid de Reportes -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
      
      <!-- Sección de Historial de Pedidos -->
      <div class="bg-surface rounded-xl p-6 border border-white/10">
        <div class="flex items-center justify-between mb-6">
          <h2 class="font-heading text-xl font-semibold text-text-primary flex items-center">
            <svg class="w-5 h-5 mr-2 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
            </svg>
            Historial de Pedidos
          </h2>
          <div id="orders-count" class="text-sm text-text-secondary bg-background px-3 py-1 rounded-full">
            0 pedidos
          </div>
        </div>
        
        <div id="orders-container" class="min-h-[400px]">
          <!-- Loading state -->
          <div id="orders-loading" class="flex flex-col items-center justify-center h-64 text-text-secondary">
            <div class="w-8 h-8 border-4 border-gray-300 border-t-accent rounded-full animate-spin mb-4"></div>
            <p>Cargando pedidos...</p>
          </div>
          
          <!-- Error state -->
          <div id="orders-error" class="hidden">
            <div class="flex flex-col items-center justify-center h-64 text-red-400">
              <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <p class="text-center">Error al cargar los pedidos</p>
              <button id="retry-orders-btn" class="mt-2 text-accent hover:text-accent/80 text-sm">
                Intentar nuevamente
              </button>
            </div>
          </div>
          
          <!-- Empty state -->
          <div id="orders-empty" class="hidden">
            <div class="flex flex-col items-center justify-center h-64 text-text-secondary">
              <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"></path>
              </svg>
              <p>No se encontraron pedidos</p>
            </div>
          </div>
          
          <!-- Table -->
          <div id="orders-table" class="hidden overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b border-white/10">
                  <th class="text-left py-3 px-2 text-text-secondary font-medium text-sm">Código</th>
                  <th class="text-left py-3 px-2 text-text-secondary font-medium text-sm">Mesa</th>
                  <th class="text-right py-3 px-2 text-text-secondary font-medium text-sm">Total</th>
                  <th class="text-center py-3 px-2 text-text-secondary font-medium text-sm">Estado</th>
                  <th class="text-right py-3 px-2 text-text-secondary font-medium text-sm">Fecha</th>
                </tr>
              </thead>
              <tbody id="orders-tbody">
                <!-- Los pedidos se renderizarán aquí dinámicamente -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Sección de Platos Más Vendidos -->
      <div class="bg-surface rounded-xl p-6 border border-white/10">
        <div class="flex items-center justify-between mb-6">
          <h2 class="font-heading text-xl font-semibold text-text-primary flex items-center">
            <svg class="w-5 h-5 mr-2 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
            </svg>
            Top 10 Platos Más Vendidos
          </h2>
          <div id="bestsellers-revenue" class="text-sm text-text-secondary bg-background px-3 py-1 rounded-full">
            $0 ingresos
          </div>
        </div>
        
        <div id="bestsellers-container" class="min-h-[400px]">
          <!-- Loading state -->
          <div id="bestsellers-loading" class="flex flex-col items-center justify-center h-64 text-text-secondary">
            <div class="w-8 h-8 border-4 border-gray-300 border-t-accent rounded-full animate-spin mb-4"></div>
            <p>Cargando bestsellers...</p>
          </div>
          
          <!-- Error state -->
          <div id="bestsellers-error" class="hidden">
            <div class="flex flex-col items-center justify-center h-64 text-red-400">
              <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <p class="text-center">Error al cargar los bestsellers</p>
              <button id="retry-bestsellers-btn" class="mt-2 text-accent hover:text-accent/80 text-sm">
                Intentar nuevamente
              </button>
            </div>
          </div>
          
          <!-- Empty state -->
          <div id="bestsellers-empty" class="hidden">
            <div class="flex flex-col items-center justify-center h-64 text-text-secondary">
              <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"></path>
              </svg>
              <p>No se encontraron platos vendidos</p>
            </div>
          </div>
          
          <!-- Chart Container -->
          <div id="bestsellers-chart" class="hidden mb-6">
            <canvas id="bestsellers-canvas" width="400" height="200"></canvas>
          </div>
          
          <!-- List -->
          <div id="bestsellers-list" class="hidden space-y-3">
            <!-- Los bestsellers se renderizarán aquí dinámicamente -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js CDN para los gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../../../scripts/reports-page.ts"></script>
</AdminLayout>

<style>
  /* Animaciones suaves */
  .fade-in {
    animation: fadeIn 0.3s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Estilos para la tabla */
  #orders-table table {
    border-collapse: separate;
    border-spacing: 0;
  }

  #orders-tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }

  /* Estilos responsivos */
  @media (max-width: 768px) {
    .grid.xl\\:grid-cols-2 {
      grid-template-columns: 1fr;
    }
    
    #orders-table {
      overflow-x: scroll;
    }
    
    .grid.md\\:grid-cols-4 {
      grid-template-columns: 1fr;
    }
  }
</style>
