---
// Pre-renderizar esta página estáticamente
export const prerender = true;

import AdminLayout from "../../../layouts/AdminLayout.astro";
---

<AdminLayout title="Vista de Cocina">
  <div class="h-full flex flex-col">
    <!-- Header de la Vista de Cocina -->
    <div class="flex justify-between items-center mb-6">
      <div class="flex items-center gap-4">
        <div class="p-3 bg-orange-600/20 rounded-lg">
          <svg class="w-8 h-8 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div>
          <h1 class="font-heading text-3xl font-bold text-text-primary">Vista de Cocina</h1>
          <p class="text-text-secondary">Gestión de comandas y pagos en tiempo real</p>
        </div>
      </div>
      
      <!-- Indicadores de Estado -->
      <div class="flex items-center gap-6">
        <!-- Estado de Conexión -->
        <div class="flex items-center gap-2">
          <div id="connection-indicator" class="w-3 h-3 bg-gray-500 rounded-full animate-pulse"></div>
          <span id="connection-status" class="text-text-secondary text-sm">Conectando...</span>
        </div>
        
        <!-- Contador Total de Pedidos -->
        <div class="text-right">
          <p class="text-text-secondary text-sm">Pedidos Activos</p>
          <p id="total-orders-count" class="text-xl font-bold text-text-primary">0</p>
        </div>
        
        <!-- Botón de Refresh Manual -->
        <button 
          id="refresh-orders-btn"
          class="bg-surface border border-white/20 text-text-primary hover:bg-white/5 p-2 rounded-lg transition-colors"
          title="Actualizar pedidos"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="flex bg-surface rounded-lg p-1 mb-6 w-fit">
      <button 
        id="active-orders-tab"
        class="kitchen-tab px-4 py-2 rounded-md text-sm font-medium transition-colors active bg-accent text-white"
        data-tab="active-orders"
      >
        <div class="flex items-center space-x-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
          <span>Comandas Activas</span>
          <span id="active-orders-badge" class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">0</span>
        </div>
      </button>
      
      <button 
        id="pending-payments-tab"
        class="kitchen-tab px-4 py-2 rounded-md text-sm font-medium transition-colors text-text-secondary hover:text-text-primary hover:bg-white/5"
        data-tab="pending-payments"
      >
        <div class="flex items-center space-x-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
          <span>Pagos Pendientes</span>
          <span id="pending-payments-badge" class="bg-yellow-600 text-white text-xs px-2 py-1 rounded-full">0</span>
        </div>
      </button>
    </div>

    <!-- Tab Content: Comandas Activas (Kanban Board) -->
    <div id="active-orders-content" class="tab-content flex-1 flex gap-6 min-h-0"
    <div class="flex-1 flex gap-6 min-h-0">
      <!-- Columna: Pendiente -->
      <div class="flex-1 bg-surface rounded-xl p-4 border border-white/10 min-w-0">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
            <h2 class="font-heading text-lg font-semibold text-text-primary">Pendiente</h2>
            <span id="pending-count" class="bg-yellow-600/20 text-yellow-400 text-xs px-2 py-1 rounded-full font-medium">0</span>
          </div>
          <div class="text-xs text-text-secondary">
            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Nuevos pedidos
          </div>
        </div>
        
        <!-- Container de Pedidos Pendientes -->
        <div id="pending-orders" class="space-y-3 overflow-y-auto max-h-full">
          <!-- Loading inicial -->
          <div id="pending-loading" class="space-y-3">
            <div class="bg-background p-4 rounded-lg animate-pulse">
              <div class="h-4 bg-gray-600 rounded w-3/4 mb-2"></div>
              <div class="h-3 bg-gray-600 rounded w-1/2 mb-3"></div>
              <div class="h-8 bg-gray-600 rounded w-full"></div>
            </div>
            <div class="bg-background p-4 rounded-lg animate-pulse">
              <div class="h-4 bg-gray-600 rounded w-2/3 mb-2"></div>
              <div class="h-3 bg-gray-600 rounded w-1/3 mb-3"></div>
              <div class="h-8 bg-gray-600 rounded w-full"></div>
            </div>
          </div>
          
          <!-- Empty state -->
          <div id="pending-empty" class="hidden text-center py-12">
            <svg class="w-12 h-12 text-text-secondary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"></path>
            </svg>
            <p class="text-text-secondary">No hay pedidos pendientes</p>
          </div>
        </div>
      </div>

      <!-- Columna: En Preparación -->
      <div class="flex-1 bg-surface rounded-xl p-4 border border-white/10 min-w-0">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
            <h2 class="font-heading text-lg font-semibold text-text-primary">En Preparación</h2>
            <span id="inPreparation-count" class="bg-blue-600/20 text-blue-400 text-xs px-2 py-1 rounded-full font-medium">0</span>
          </div>
          <div class="text-xs text-text-secondary">
            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            Cocinando
          </div>
        </div>
        
        <!-- Container de Pedidos En Preparación -->
        <div id="inPreparation-orders" class="space-y-3 overflow-y-auto max-h-full">
          <!-- Loading inicial -->
          <div id="inPreparation-loading" class="space-y-3">
            <div class="bg-background p-4 rounded-lg animate-pulse">
              <div class="h-4 bg-gray-600 rounded w-3/4 mb-2"></div>
              <div class="h-3 bg-gray-600 rounded w-1/2 mb-3"></div>
              <div class="h-8 bg-gray-600 rounded w-full"></div>
            </div>
          </div>
          
          <!-- Empty state -->
          <div id="inPreparation-empty" class="hidden text-center py-12">
            <svg class="w-12 h-12 text-text-secondary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            <p class="text-text-secondary">No hay pedidos en preparación</p>
          </div>
        </div>
      </div>

      <!-- Columna: Listo -->
      <div class="flex-1 bg-surface rounded-xl p-4 border border-white/10 min-w-0">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
            <h2 class="font-heading text-lg font-semibold text-text-primary">Listo</h2>
            <span id="ready-count" class="bg-green-600/20 text-green-400 text-xs px-2 py-1 rounded-full font-medium">0</span>
          </div>
          <div class="text-xs text-text-secondary">
            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Para entregar
          </div>
        </div>
        
        <!-- Container de Pedidos Listos -->
        <div id="ready-orders" class="space-y-3 overflow-y-auto max-h-full">
          <!-- Loading inicial -->
          <div id="ready-loading" class="space-y-3">
            <div class="bg-background p-4 rounded-lg animate-pulse">
              <div class="h-4 bg-gray-600 rounded w-3/4 mb-2"></div>
              <div class="h-3 bg-gray-600 rounded w-1/2 mb-3"></div>
              <div class="h-8 bg-gray-600 rounded w-full"></div>
            </div>
          </div>
          
          <!-- Empty state -->
          <div id="ready-empty" class="hidden text-center py-12">
            <svg class="w-12 h-12 text-text-secondary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p class="text-text-secondary">No hay pedidos listos</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Pagos Pendientes -->
    <div id="pending-payments-content" class="tab-content flex-1 hidden">
      <div class="bg-surface rounded-xl p-6 border border-white/10 h-full">
        <!-- Header de la tabla -->
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-3">
            <div class="p-2 bg-yellow-600/20 rounded-lg">
              <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
            </div>
            <div>
              <h2 class="font-heading text-xl font-semibold text-text-primary">Pedidos Esperando Pago</h2>
              <p class="text-text-secondary text-sm">Confirma los pagos para enviar las comandas a cocina</p>
            </div>
          </div>
          
          <!-- Refresh button para pagos -->
          <button 
            id="refresh-payments-btn"
            class="bg-background border border-white/20 text-text-primary hover:bg-white/5 p-2 rounded-lg transition-colors"
            title="Actualizar pagos pendientes"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
          </button>
        </div>

        <!-- Loading State -->
        <div id="payments-loading" class="space-y-4">
          <div class="bg-background p-6 rounded-xl animate-pulse">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <div class="h-6 bg-gray-600 rounded w-1/3 mb-3"></div>
                <div class="h-4 bg-gray-600 rounded w-1/4 mb-2"></div>
                <div class="h-4 bg-gray-600 rounded w-1/5"></div>
              </div>
              <div class="w-32 h-10 bg-gray-600 rounded-lg"></div>
            </div>
          </div>
          <div class="bg-background p-6 rounded-xl animate-pulse">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <div class="h-6 bg-gray-600 rounded w-1/4 mb-3"></div>
                <div class="h-4 bg-gray-600 rounded w-1/5 mb-2"></div>
                <div class="h-4 bg-gray-600 rounded w-1/6"></div>
              </div>
              <div class="w-32 h-10 bg-gray-600 rounded-lg"></div>
            </div>
          </div>
        </div>

        <!-- Lista de Pagos Pendientes -->
        <div id="pending-payments-list" class="space-y-4 overflow-y-auto max-h-full hidden">
          <!-- Los items se generarán dinámicamente aquí -->
        </div>

        <!-- Empty State -->
        <div id="payments-empty" class="hidden text-center py-20">
          <div class="w-16 h-16 bg-green-600/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-medium text-text-primary mb-2">¡Todos los pagos están al día!</h3>
          <p class="text-text-secondary">No hay pedidos esperando confirmación de pago en este momento.</p>
        </div>
      </div>
    </div>

    <!-- Toast de Notificaciones Específico para Cocina -->
    <div id="kitchen-notifications" class="fixed top-4 right-4 space-y-2 z-50 pointer-events-none">
      <!-- Las notificaciones de nuevos pedidos aparecerán aquí -->
    </div>
  </div>

  <!-- Scripts -->
  <script src="../../../scripts/kitchen-page.ts"></script>
</AdminLayout>

<style>
  /* Animaciones personalizadas para la cocina */
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: .5;
    }
  }

  @keyframes newOrderPulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7);
    }
    50% {
      box-shadow: 0 0 0 10px rgba(251, 191, 36, 0);
    }
  }

  @keyframes slideInFromTop {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideOut {
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }

  .new-order-animation {
    animation: newOrderPulse 2s ease-in-out 3, slideInFromTop 0.5s ease-out;
    border: 2px solid rgba(251, 191, 36, 0.5);
  }

  .order-moving {
    transition: all 0.3s ease-in-out;
    transform: scale(0.95);
    opacity: 0.7;
  }

  .kitchen-toast {
    animation: slideInFromTop 0.3s ease-out, slideOut 0.3s ease-in 4.7s;
  }

  /* Estados de conexión */
  .connected { 
    background-color: rgb(16 185 129);
  }
  .connecting { 
    background-color: rgb(245 158 11);
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  .disconnected { 
    background-color: rgb(239 68 68);
  }

  /* Estilos para las pestañas */
  .kitchen-tab {
    transition: all 0.2s ease-in-out;
  }

  .kitchen-tab.active {
    background-color: rgb(59 130 246);
    color: white;
  }

  .kitchen-tab:not(.active):hover {
    background-color: rgba(255, 255, 255, 0.05);
    color: rgb(229 231 235);
  }

  .tab-content {
    animation: fadeIn 0.3s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Animación para elementos que desaparecen */
  .payment-item-removing {
    animation: slideOutLeft 0.3s ease-in-out forwards;
  }

  @keyframes slideOutLeft {
    to {
      transform: translateX(-100%);
      opacity: 0;
    }
  }

  /* Mejoras de scrolling */
  .overflow-y-auto {
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
  }

  .overflow-y-auto::-webkit-scrollbar {
    width: 4px;
  }

  .overflow-y-auto::-webkit-scrollbar-track {
    background: transparent;
  }

  .overflow-y-auto::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
  }

  .overflow-y-auto::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .flex-1 {
      min-width: 280px;
    }
  }
</style>
